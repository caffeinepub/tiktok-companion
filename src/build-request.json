{
  "kind": "build_request",
  "title": "Fix unpublish functionality and enforce staff code entry on every access",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-16",
      "text": "Remove sessionStorage persistence for staff code verification so that staff must enter the code '2807' every time they access the Settings page moderation controls",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "make every one have to type the staff code"
        ]
      },
      "acceptanceCriteria": [
        "Staff code verification state is not stored in sessionStorage",
        "Users must enter code '2807' each time they visit Settings page",
        "Moderation controls remain locked until code is entered, even after page refresh"
      ]
    },
    {
      "id": "REQ-17",
      "text": "Implement backend enforcement of publication state where unpublished state blocks all non-admin API calls except getPublicationState",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Make the app ACTUALY get unpublished"
        ]
      },
      "acceptanceCriteria": [
        "When publicationState is #unpublished, all user-facing API methods return an error or empty results for non-admin callers",
        "getPublicationState method remains accessible to all users regardless of publication state",
        "Admin users (verified via authorization system) can access all methods even when unpublished",
        "Methods to protect: getUserProfile, getVideoIdeas, addVideoIdea, updateVideoIdea, deleteVideoIdea, scheduleVideo, getHashtags, addHashtag"
      ]
    },
    {
      "id": "REQ-18",
      "text": "Update frontend to fetch publication state before any data queries and display UnpublishedOverlay on all pages except Settings when state is unpublished",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Make the app ACTUALY get unpublished"
        ]
      },
      "acceptanceCriteria": [
        "Create a usePublicationState hook that queries backend publication state",
        "Dashboard, Calendar, Hashtags, and Landing pages check publication state before rendering main content",
        "UnpublishedOverlay displays on affected pages when state is #unpublished",
        "Settings page always remains accessible for staff to republish the app"
      ]
    },
    {
      "id": "REQ-19",
      "text": "Fix the republish button functionality so that clicking it successfully changes the backend publication state from unpublished back to published",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "the republish button to work"
        ]
      },
      "acceptanceCriteria": [
        "Clicking the Republish button in Settings triggers the setPublicationState backend method with #published",
        "Backend state changes from #unpublished to #published",
        "Button label updates to show 'Unpublish' after successful republish",
        "App becomes accessible to all users immediately after republishing",
        "Success toast notification displays confirming republish action"
      ]
    }
  ],
  "constraints": [
    "Staff code must remain '2807'",
    "Settings page must remain accessible regardless of publication state",
    "Admin authorization system (MixinAuthorization) must be used for backend publication state enforcement",
    "Do not modify the UnpublishedOverlay component UI"
  ],
  "nonGoals": [
    "Changing the staff code value",
    "Adding additional admin roles or permissions",
    "Modifying the visual design of the Settings page or UnpublishedOverlay"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}